server {
    listen 80;
    server_name localhost;

    # Access logs
    access_log /var/log/nginx/smokeping.access.log;
    error_log /var/log/nginx/smokeping.error.log;

    # Web root for static files
    root /usr/share/smokeping/www;
    index smokeping.cgi;

    # Handle the CGI script
    location = /smokeping.cgi {
        gzip off;
        fastcgi_pass unix:/var/run/fcgiwrap.sock;
        include fastcgi_params;
        # The SCRIPT_FILENAME needs to be the actual path to the cgi script
        fastcgi_param SCRIPT_FILENAME /usr/share/smokeping/cgi/smokeping.cgi;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param QUERY_STRING $query_string;
        fastcgi_param REQUEST_METHOD $request_method;
        fastcgi_param CONTENT_TYPE $content_type;
        fastcgi_param CONTENT_LENGTH $content_length;
    }

    # Handle generated graphs
    location ~ ^/(img|rrd)/ {
        alias /data/smokeping/;
        expires 1h;
        add_header Cache-Control "public";
    }

    # Fallback to the CGI script for other requests
    location / {
        try_files $uri $uri/ /smokeping.cgi$is_args$args;
    }
}
